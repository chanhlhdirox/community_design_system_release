import { filter, isFinite } from 'lodash';
import Big from 'big.js';
import { Separator } from '../enum/separator.enum';
export class NumberUtils {
    static parseMaskNumber(value, decimalSeparator, allowNegativeValues = true, fixedDecimals = true) {
        let parsed = NumberUtils.removeDisallowedCharacters(value, decimalSeparator, allowNegativeValues);
        if (isFinite(parseFloat(parsed))) {
            parsed = parsed.replace(decimalSeparator, Separator.DOT);
            const decimals = fixedDecimals ? 2 : parsed.split(Separator.DOT)[1]?.length || 0;
            return parseFloat(Big(parsed.replace(decimalSeparator, Separator.DOT)).toFixed(decimals));
        }
    }
    static removeDisallowedCharacters(value, decimalSeparator, allowNegativeValues = true) {
        let foundValidCharacter = false;
        let foundSeparator = false;
        return filter(value, (character) => {
            const foundInvalidCharacter = this.getRegex(!foundValidCharacter && allowNegativeValues, decimalSeparator, !foundSeparator).test(character);
            foundValidCharacter = foundValidCharacter || !foundInvalidCharacter;
            foundSeparator = foundSeparator || character === decimalSeparator;
            return !foundInvalidCharacter;
        }).join('');
    }
    static getRegex(allowedMinus, decimalSeparator, allowedSeparator = true) {
        const minus = '-';
        let allowedCharacters = `0-9`;
        if (allowedSeparator && decimalSeparator) {
            allowedCharacters = `${decimalSeparator}${allowedCharacters}`;
        }
        if (allowedMinus) {
            allowedCharacters = `${minus}${allowedCharacters}`;
        }
        return new RegExp(`[^${allowedCharacters}]`, 'g');
    }
    static removeDisallowedCharactersWithoutSeparator(value, allowNegativeValues = true) {
        let foundValidCharacter = false;
        return filter(value, (character) => {
            const foundInvalidCharacter = this.getRegexWithoutSeparator(!foundValidCharacter && allowNegativeValues).test(character);
            foundValidCharacter = foundValidCharacter || !foundInvalidCharacter;
            return !foundInvalidCharacter;
        }).join('');
    }
    static getRegexWithoutSeparator(allowedMinus) {
        const minus = '-';
        let allowedCharacters = `.,0-9`;
        if (allowedMinus) {
            allowedCharacters = `${minus}${allowedCharacters}`;
        }
        return new RegExp(`[^${allowedCharacters}]`, 'g');
    }
}
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoibnVtYmVyLXV0aWxzLmpzIiwic291cmNlUm9vdCI6IiIsInNvdXJjZXMiOlsiLi4vLi4vLi4vLi4vLi4vLi4vcHJvamVjdHMvdXAvY29tcG9uZW50cy9udW1lcmljYWwtbWFzay9oZWxwZXJzL251bWJlci11dGlscy50cyJdLCJuYW1lcyI6W10sIm1hcHBpbmdzIjoiQUFBQSxPQUFPLEVBQUUsTUFBTSxFQUFFLFFBQVEsRUFBRSxNQUFNLFFBQVEsQ0FBQztBQUMxQyxPQUFPLEdBQUcsTUFBTSxRQUFRLENBQUM7QUFDekIsT0FBTyxFQUFFLFNBQVMsRUFBRSxNQUFNLHdCQUF3QixDQUFDO0FBRW5ELE1BQU0sT0FBTyxXQUFXO0lBQ3RCLE1BQU0sQ0FBQyxlQUFlLENBQUMsS0FBYSxFQUFFLGdCQUE0QixFQUFFLG1CQUFtQixHQUFHLElBQUksRUFBRSxnQkFBeUIsSUFBSTtRQUMzSCxJQUFJLE1BQU0sR0FBRyxXQUFXLENBQUMsMEJBQTBCLENBQUMsS0FBSyxFQUFFLGdCQUFnQixFQUFFLG1CQUFtQixDQUFDLENBQUM7UUFDbEcsSUFBSSxRQUFRLENBQUMsVUFBVSxDQUFDLE1BQU0sQ0FBQyxDQUFDLEVBQUU7WUFDaEMsTUFBTSxHQUFHLE1BQU0sQ0FBQyxPQUFPLENBQUMsZ0JBQWdCLEVBQUUsU0FBUyxDQUFDLEdBQUcsQ0FBQyxDQUFDO1lBQ3pELE1BQU0sUUFBUSxHQUFHLGFBQWEsQ0FBQyxDQUFDLENBQUMsQ0FBQyxDQUFDLENBQUMsQ0FBQyxNQUFNLENBQUMsS0FBSyxDQUFDLFNBQVMsQ0FBQyxHQUFHLENBQUMsQ0FBQyxDQUFDLENBQUMsRUFBRSxNQUFNLElBQUksQ0FBQyxDQUFDO1lBQ2pGLE9BQU8sVUFBVSxDQUFDLEdBQUcsQ0FBQyxNQUFNLENBQUMsT0FBTyxDQUFDLGdCQUFnQixFQUFFLFNBQVMsQ0FBQyxHQUFHLENBQUMsQ0FBQyxDQUFDLE9BQU8sQ0FBQyxRQUFRLENBQUMsQ0FBQyxDQUFDO1NBQzNGO0lBQ0gsQ0FBQztJQUVELE1BQU0sQ0FBQywwQkFBMEIsQ0FBQyxLQUFhLEVBQUUsZ0JBQTRCLEVBQUUsbUJBQW1CLEdBQUcsSUFBSTtRQUN2RyxJQUFJLG1CQUFtQixHQUFHLEtBQUssQ0FBQztRQUNoQyxJQUFJLGNBQWMsR0FBRyxLQUFLLENBQUM7UUFFM0IsT0FBTyxNQUFNLENBQUMsS0FBSyxFQUFFLENBQUMsU0FBUyxFQUFFLEVBQUU7WUFDakMsTUFBTSxxQkFBcUIsR0FBRyxJQUFJLENBQUMsUUFBUSxDQUFDLENBQUMsbUJBQW1CLElBQUksbUJBQW1CLEVBQUUsZ0JBQWdCLEVBQUUsQ0FBQyxjQUFjLENBQUMsQ0FBQyxJQUFJLENBQzlILFNBQVMsQ0FDVixDQUFDO1lBRUYsbUJBQW1CLEdBQUcsbUJBQW1CLElBQUksQ0FBQyxxQkFBcUIsQ0FBQztZQUNwRSxjQUFjLEdBQUcsY0FBYyxJQUFJLFNBQVMsS0FBSyxnQkFBZ0IsQ0FBQztZQUVsRSxPQUFPLENBQUMscUJBQXFCLENBQUM7UUFDaEMsQ0FBQyxDQUFDLENBQUMsSUFBSSxDQUFDLEVBQUUsQ0FBQyxDQUFDO0lBQ2QsQ0FBQztJQUVELE1BQU0sQ0FBQyxRQUFRLENBQUMsWUFBYSxFQUFFLGdCQUE0QixFQUFFLGdCQUFnQixHQUFHLElBQUk7UUFDbEYsTUFBTSxLQUFLLEdBQUcsR0FBRyxDQUFDO1FBQ2xCLElBQUksaUJBQWlCLEdBQUcsS0FBSyxDQUFDO1FBRTlCLElBQUksZ0JBQWdCLElBQUksZ0JBQWdCLEVBQUU7WUFDeEMsaUJBQWlCLEdBQUcsR0FBRyxnQkFBZ0IsR0FBRyxpQkFBaUIsRUFBRSxDQUFDO1NBQy9EO1FBRUQsSUFBSSxZQUFZLEVBQUU7WUFDaEIsaUJBQWlCLEdBQUcsR0FBRyxLQUFLLEdBQUcsaUJBQWlCLEVBQUUsQ0FBQztTQUNwRDtRQUNELE9BQU8sSUFBSSxNQUFNLENBQUMsS0FBSyxpQkFBaUIsR0FBRyxFQUFFLEdBQUcsQ0FBQyxDQUFDO0lBQ3BELENBQUM7SUFFRCxNQUFNLENBQUMsMENBQTBDLENBQUMsS0FBYSxFQUFFLG1CQUFtQixHQUFHLElBQUk7UUFDekYsSUFBSSxtQkFBbUIsR0FBRyxLQUFLLENBQUM7UUFFaEMsT0FBTyxNQUFNLENBQUMsS0FBSyxFQUFFLENBQUMsU0FBUyxFQUFFLEVBQUU7WUFDakMsTUFBTSxxQkFBcUIsR0FBRyxJQUFJLENBQUMsd0JBQXdCLENBQUMsQ0FBQyxtQkFBbUIsSUFBSSxtQkFBbUIsQ0FBQyxDQUFDLElBQUksQ0FBQyxTQUFTLENBQUMsQ0FBQztZQUV6SCxtQkFBbUIsR0FBRyxtQkFBbUIsSUFBSSxDQUFDLHFCQUFxQixDQUFDO1lBRXBFLE9BQU8sQ0FBQyxxQkFBcUIsQ0FBQztRQUNoQyxDQUFDLENBQUMsQ0FBQyxJQUFJLENBQUMsRUFBRSxDQUFDLENBQUM7SUFDZCxDQUFDO0lBRUQsTUFBTSxDQUFDLHdCQUF3QixDQUFDLFlBQWE7UUFDM0MsTUFBTSxLQUFLLEdBQUcsR0FBRyxDQUFDO1FBQ2xCLElBQUksaUJBQWlCLEdBQUcsT0FBTyxDQUFDO1FBRWhDLElBQUksWUFBWSxFQUFFO1lBQ2hCLGlCQUFpQixHQUFHLEdBQUcsS0FBSyxHQUFHLGlCQUFpQixFQUFFLENBQUM7U0FDcEQ7UUFDRCxPQUFPLElBQUksTUFBTSxDQUFDLEtBQUssaUJBQWlCLEdBQUcsRUFBRSxHQUFHLENBQUMsQ0FBQztJQUNwRCxDQUFDO0NBQ0YiLCJzb3VyY2VzQ29udGVudCI6WyJpbXBvcnQgeyBmaWx0ZXIsIGlzRmluaXRlIH0gZnJvbSAnbG9kYXNoJztcbmltcG9ydCBCaWcgZnJvbSAnYmlnLmpzJztcbmltcG9ydCB7IFNlcGFyYXRvciB9IGZyb20gJy4uL2VudW0vc2VwYXJhdG9yLmVudW0nO1xuXG5leHBvcnQgY2xhc3MgTnVtYmVyVXRpbHMge1xuICBzdGF0aWMgcGFyc2VNYXNrTnVtYmVyKHZhbHVlOiBzdHJpbmcsIGRlY2ltYWxTZXBhcmF0b3I/OiBTZXBhcmF0b3IsIGFsbG93TmVnYXRpdmVWYWx1ZXMgPSB0cnVlLCBmaXhlZERlY2ltYWxzOiBib29sZWFuID0gdHJ1ZSkge1xuICAgIGxldCBwYXJzZWQgPSBOdW1iZXJVdGlscy5yZW1vdmVEaXNhbGxvd2VkQ2hhcmFjdGVycyh2YWx1ZSwgZGVjaW1hbFNlcGFyYXRvciwgYWxsb3dOZWdhdGl2ZVZhbHVlcyk7XG4gICAgaWYgKGlzRmluaXRlKHBhcnNlRmxvYXQocGFyc2VkKSkpIHtcbiAgICAgIHBhcnNlZCA9IHBhcnNlZC5yZXBsYWNlKGRlY2ltYWxTZXBhcmF0b3IsIFNlcGFyYXRvci5ET1QpO1xuICAgICAgY29uc3QgZGVjaW1hbHMgPSBmaXhlZERlY2ltYWxzID8gMiA6IHBhcnNlZC5zcGxpdChTZXBhcmF0b3IuRE9UKVsxXT8ubGVuZ3RoIHx8IDA7XG4gICAgICByZXR1cm4gcGFyc2VGbG9hdChCaWcocGFyc2VkLnJlcGxhY2UoZGVjaW1hbFNlcGFyYXRvciwgU2VwYXJhdG9yLkRPVCkpLnRvRml4ZWQoZGVjaW1hbHMpKTtcbiAgICB9XG4gIH1cblxuICBzdGF0aWMgcmVtb3ZlRGlzYWxsb3dlZENoYXJhY3RlcnModmFsdWU6IHN0cmluZywgZGVjaW1hbFNlcGFyYXRvcj86IFNlcGFyYXRvciwgYWxsb3dOZWdhdGl2ZVZhbHVlcyA9IHRydWUpOiBzdHJpbmcge1xuICAgIGxldCBmb3VuZFZhbGlkQ2hhcmFjdGVyID0gZmFsc2U7XG4gICAgbGV0IGZvdW5kU2VwYXJhdG9yID0gZmFsc2U7XG5cbiAgICByZXR1cm4gZmlsdGVyKHZhbHVlLCAoY2hhcmFjdGVyKSA9PiB7XG4gICAgICBjb25zdCBmb3VuZEludmFsaWRDaGFyYWN0ZXIgPSB0aGlzLmdldFJlZ2V4KCFmb3VuZFZhbGlkQ2hhcmFjdGVyICYmIGFsbG93TmVnYXRpdmVWYWx1ZXMsIGRlY2ltYWxTZXBhcmF0b3IsICFmb3VuZFNlcGFyYXRvcikudGVzdChcbiAgICAgICAgY2hhcmFjdGVyXG4gICAgICApO1xuXG4gICAgICBmb3VuZFZhbGlkQ2hhcmFjdGVyID0gZm91bmRWYWxpZENoYXJhY3RlciB8fCAhZm91bmRJbnZhbGlkQ2hhcmFjdGVyO1xuICAgICAgZm91bmRTZXBhcmF0b3IgPSBmb3VuZFNlcGFyYXRvciB8fCBjaGFyYWN0ZXIgPT09IGRlY2ltYWxTZXBhcmF0b3I7XG5cbiAgICAgIHJldHVybiAhZm91bmRJbnZhbGlkQ2hhcmFjdGVyO1xuICAgIH0pLmpvaW4oJycpO1xuICB9XG5cbiAgc3RhdGljIGdldFJlZ2V4KGFsbG93ZWRNaW51cz8sIGRlY2ltYWxTZXBhcmF0b3I/OiBTZXBhcmF0b3IsIGFsbG93ZWRTZXBhcmF0b3IgPSB0cnVlKSB7XG4gICAgY29uc3QgbWludXMgPSAnLSc7XG4gICAgbGV0IGFsbG93ZWRDaGFyYWN0ZXJzID0gYDAtOWA7XG5cbiAgICBpZiAoYWxsb3dlZFNlcGFyYXRvciAmJiBkZWNpbWFsU2VwYXJhdG9yKSB7XG4gICAgICBhbGxvd2VkQ2hhcmFjdGVycyA9IGAke2RlY2ltYWxTZXBhcmF0b3J9JHthbGxvd2VkQ2hhcmFjdGVyc31gO1xuICAgIH1cblxuICAgIGlmIChhbGxvd2VkTWludXMpIHtcbiAgICAgIGFsbG93ZWRDaGFyYWN0ZXJzID0gYCR7bWludXN9JHthbGxvd2VkQ2hhcmFjdGVyc31gO1xuICAgIH1cbiAgICByZXR1cm4gbmV3IFJlZ0V4cChgW14ke2FsbG93ZWRDaGFyYWN0ZXJzfV1gLCAnZycpO1xuICB9XG5cbiAgc3RhdGljIHJlbW92ZURpc2FsbG93ZWRDaGFyYWN0ZXJzV2l0aG91dFNlcGFyYXRvcih2YWx1ZTogc3RyaW5nLCBhbGxvd05lZ2F0aXZlVmFsdWVzID0gdHJ1ZSk6IHN0cmluZyB7XG4gICAgbGV0IGZvdW5kVmFsaWRDaGFyYWN0ZXIgPSBmYWxzZTtcblxuICAgIHJldHVybiBmaWx0ZXIodmFsdWUsIChjaGFyYWN0ZXIpID0+IHtcbiAgICAgIGNvbnN0IGZvdW5kSW52YWxpZENoYXJhY3RlciA9IHRoaXMuZ2V0UmVnZXhXaXRob3V0U2VwYXJhdG9yKCFmb3VuZFZhbGlkQ2hhcmFjdGVyICYmIGFsbG93TmVnYXRpdmVWYWx1ZXMpLnRlc3QoY2hhcmFjdGVyKTtcblxuICAgICAgZm91bmRWYWxpZENoYXJhY3RlciA9IGZvdW5kVmFsaWRDaGFyYWN0ZXIgfHwgIWZvdW5kSW52YWxpZENoYXJhY3RlcjtcblxuICAgICAgcmV0dXJuICFmb3VuZEludmFsaWRDaGFyYWN0ZXI7XG4gICAgfSkuam9pbignJyk7XG4gIH1cblxuICBzdGF0aWMgZ2V0UmVnZXhXaXRob3V0U2VwYXJhdG9yKGFsbG93ZWRNaW51cz8pIHtcbiAgICBjb25zdCBtaW51cyA9ICctJztcbiAgICBsZXQgYWxsb3dlZENoYXJhY3RlcnMgPSBgLiwwLTlgO1xuXG4gICAgaWYgKGFsbG93ZWRNaW51cykge1xuICAgICAgYWxsb3dlZENoYXJhY3RlcnMgPSBgJHttaW51c30ke2FsbG93ZWRDaGFyYWN0ZXJzfWA7XG4gICAgfVxuICAgIHJldHVybiBuZXcgUmVnRXhwKGBbXiR7YWxsb3dlZENoYXJhY3RlcnN9XWAsICdnJyk7XG4gIH1cbn1cbiJdfQ==
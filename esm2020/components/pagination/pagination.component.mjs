import { Component, EventEmitter, Input, Output } from '@angular/core';
import * as i0 from "@angular/core";
import * as i1 from "@angular/common";
import * as i2 from "../icons/icon.directive";
import * as i3 from "../spacing/spacing.directive";
export class PaginationComponent {
    constructor() {
        this.pageNumber = 1;
        this.pageSize = 10;
        this.collectionSize = 0;
        this.previousButtonText = 'Prev';
        this.nextButtonText = 'Next';
        this.pageNumberChange = new EventEmitter();
        this.pages = [];
        this.generatedPages = [];
        this.firstGeneratedPages = [];
        this.lastGeneratedPages = [];
        this.totalPages = 0;
        this.totalVisiblePages = 9;
        this.firstGeneratedPage = 0;
        this.lastGeneratedPage = 0;
    }
    get isPaginationHidden() {
        return this.collectionSize <= this.pageSize;
    }
    ngOnInit() {
        this.selectPage(this.pageNumber);
    }
    ngOnChanges() {
        this.buildPages();
    }
    selectPage(newPageNumber) {
        const isInTheAllowedPagesInterval = newPageNumber >= 1 && newPageNumber <= this.totalPages;
        if (isInTheAllowedPagesInterval && newPageNumber !== this.pageNumber) {
            this.pageNumberChange.emit(newPageNumber);
        }
        this.generatedPages = [];
        this.firstGeneratedPages = [];
        this.lastGeneratedPages = [];
        this.firstGeneratedPage = newPageNumber - 2;
        this.lastGeneratedPage = newPageNumber + 2;
        if (this.totalPages >= this.totalVisiblePages) {
            if (newPageNumber === 1) {
                this.lastGeneratedPage += 2;
            }
            else if (newPageNumber === 2) {
                this.lastGeneratedPage += 1;
            }
            if (newPageNumber === this.totalPages) {
                this.firstGeneratedPage -= 2;
            }
            else if (newPageNumber === this.totalPages - 1) {
                this.firstGeneratedPage -= 1;
            }
            for (let page = this.firstGeneratedPage; page <= this.lastGeneratedPage; page++) {
                if (page === 0) {
                    page += 1;
                }
                if (page > this.totalPages) {
                    continue;
                }
                this.generatedPages.push(page);
            }
            if (newPageNumber <= 4 || newPageNumber >= this.totalPages - 3) {
                for (let page = 1; page <= 4; page++) {
                    this.firstGeneratedPages.push(page);
                }
                for (let page = this.totalPages - 3; page <= this.totalPages; page++) {
                    this.lastGeneratedPages.push(page);
                }
            }
            else {
                this.firstGeneratedPages.push(1);
                this.lastGeneratedPages.push(this.totalPages);
            }
        }
    }
    buildPages() {
        this.totalPages = Math.ceil(this.collectionSize / this.pageSize);
        this.pages = Array.from({ length: this.totalPages }, (_, index) => index + 1);
    }
}
PaginationComponent.ɵfac = i0.ɵɵngDeclareFactory({ minVersion: "12.0.0", version: "14.3.0", ngImport: i0, type: PaginationComponent, deps: [], target: i0.ɵɵFactoryTarget.Component });
PaginationComponent.ɵcmp = i0.ɵɵngDeclareComponent({ minVersion: "14.0.0", version: "14.3.0", type: PaginationComponent, selector: "up-pagination", inputs: { pageNumber: "pageNumber", pageSize: "pageSize", collectionSize: "collectionSize", previousButtonText: "previousButtonText", nextButtonText: "nextButtonText" }, outputs: { pageNumberChange: "pageNumberChange" }, usesOnChanges: true, ngImport: i0, template: "<ul class=\"up-pagination\" [class.hidden]=\"isPaginationHidden\">\n  <li class=\"up-pagination-navigation-container up-pagination-previous-page\">\n    <ng-container *ngIf=\"pageNumber > 1\">\n      <div class=\"up-pagination-navigation-icon cursor-grab\" (click)=\"selectPage(1)\">\n        <i upIcon=\"first_page_small\" width=\"8px\" height=\"8px\"></i>\n      </div>\n      <span class=\"up-pagination-navigation\" upMarginLeft=\"1\" (click)=\"selectPage(pageNumber - 1)\">{{previousButtonText}}</span>\n    </ng-container>\n  </li>\n  <ng-container *ngIf=\"totalPages <= totalVisiblePages else showEllipsis\">\n    <li *ngFor=\"let page of pages\" [class.active]=\"pageNumber === page\"\n        class=\"up-pagination-item up-pagination-number\">\n      <a (click)=\"selectPage(page)\">{{page}}</a>\n    </li>\n  </ng-container>\n  <ng-template #showEllipsis>\n    <li *ngFor=\"let page of firstGeneratedPages\" class=\"up-pagination-item up-pagination-number\" [class.active]=\"pageNumber === page\">\n      <a (click)=\"selectPage(page)\">{{page}}</a>\n    </li>\n    <ng-container *ngIf=\"pageNumber >= 5\">\n      <li class=\"up-pagination-item\">\n        <a class=\"dots\">...</a>\n      </li>\n    </ng-container>\n\n    <ng-container *ngIf=\"pageNumber >= 5 && pageNumber <= totalPages-4\">\n      <li *ngFor=\"let page of generatedPages\" class=\"up-pagination-item up-pagination-number\" [class.active]=\"pageNumber === page\">\n        <a (click)=\"selectPage(page)\">{{page}}</a></li>\n    </ng-container>\n\n    <ng-container *ngIf=\"pageNumber < totalPages - 3\">\n      <li class=\"up-pagination-item\">\n        <a class=\"dots\">...</a>\n      </li>\n    </ng-container>\n    <li *ngFor=\"let page of lastGeneratedPages\" class=\"up-pagination-item up-pagination-number\" [class.active]=\"pageNumber === page\">\n      <a (click)=\"selectPage(page)\">{{page}}</a>\n    </li>\n  </ng-template>\n\n  <li class=\"up-pagination-navigation-container up-pagination-next-page\">\n    <ng-container *ngIf=\"pageNumber !== totalPages\">\n      <span class=\"up-pagination-navigation\" upMarginRight=\"1\" (click)=\"selectPage(pageNumber + 1)\">{{nextButtonText}}</span>\n      <div class=\"up-pagination-navigation-icon cursor-grab\" (click)=\"selectPage(totalPages)\">\n        <i upIcon=\"last_page_small\" width=\"8px\" height=\"8px\"></i>\n      </div>\n    </ng-container>\n  </li>\n</ul>\n", dependencies: [{ kind: "directive", type: i1.NgForOf, selector: "[ngFor][ngForOf]", inputs: ["ngForOf", "ngForTrackBy", "ngForTemplate"] }, { kind: "directive", type: i1.NgIf, selector: "[ngIf]", inputs: ["ngIf", "ngIfThen", "ngIfElse"] }, { kind: "directive", type: i2.UpIconDirective, selector: "[upIcon]", inputs: ["upIcon", "fallback", "color", "width", "height"] }, { kind: "directive", type: i3.UpMarginRightDirective, selector: "[upMarginRight]", inputs: ["upMarginRight"] }, { kind: "directive", type: i3.UpMarginLeftDirective, selector: "[upMarginLeft]", inputs: ["upMarginLeft"] }] });
i0.ɵɵngDeclareClassMetadata({ minVersion: "12.0.0", version: "14.3.0", ngImport: i0, type: PaginationComponent, decorators: [{
            type: Component,
            args: [{ selector: 'up-pagination', template: "<ul class=\"up-pagination\" [class.hidden]=\"isPaginationHidden\">\n  <li class=\"up-pagination-navigation-container up-pagination-previous-page\">\n    <ng-container *ngIf=\"pageNumber > 1\">\n      <div class=\"up-pagination-navigation-icon cursor-grab\" (click)=\"selectPage(1)\">\n        <i upIcon=\"first_page_small\" width=\"8px\" height=\"8px\"></i>\n      </div>\n      <span class=\"up-pagination-navigation\" upMarginLeft=\"1\" (click)=\"selectPage(pageNumber - 1)\">{{previousButtonText}}</span>\n    </ng-container>\n  </li>\n  <ng-container *ngIf=\"totalPages <= totalVisiblePages else showEllipsis\">\n    <li *ngFor=\"let page of pages\" [class.active]=\"pageNumber === page\"\n        class=\"up-pagination-item up-pagination-number\">\n      <a (click)=\"selectPage(page)\">{{page}}</a>\n    </li>\n  </ng-container>\n  <ng-template #showEllipsis>\n    <li *ngFor=\"let page of firstGeneratedPages\" class=\"up-pagination-item up-pagination-number\" [class.active]=\"pageNumber === page\">\n      <a (click)=\"selectPage(page)\">{{page}}</a>\n    </li>\n    <ng-container *ngIf=\"pageNumber >= 5\">\n      <li class=\"up-pagination-item\">\n        <a class=\"dots\">...</a>\n      </li>\n    </ng-container>\n\n    <ng-container *ngIf=\"pageNumber >= 5 && pageNumber <= totalPages-4\">\n      <li *ngFor=\"let page of generatedPages\" class=\"up-pagination-item up-pagination-number\" [class.active]=\"pageNumber === page\">\n        <a (click)=\"selectPage(page)\">{{page}}</a></li>\n    </ng-container>\n\n    <ng-container *ngIf=\"pageNumber < totalPages - 3\">\n      <li class=\"up-pagination-item\">\n        <a class=\"dots\">...</a>\n      </li>\n    </ng-container>\n    <li *ngFor=\"let page of lastGeneratedPages\" class=\"up-pagination-item up-pagination-number\" [class.active]=\"pageNumber === page\">\n      <a (click)=\"selectPage(page)\">{{page}}</a>\n    </li>\n  </ng-template>\n\n  <li class=\"up-pagination-navigation-container up-pagination-next-page\">\n    <ng-container *ngIf=\"pageNumber !== totalPages\">\n      <span class=\"up-pagination-navigation\" upMarginRight=\"1\" (click)=\"selectPage(pageNumber + 1)\">{{nextButtonText}}</span>\n      <div class=\"up-pagination-navigation-icon cursor-grab\" (click)=\"selectPage(totalPages)\">\n        <i upIcon=\"last_page_small\" width=\"8px\" height=\"8px\"></i>\n      </div>\n    </ng-container>\n  </li>\n</ul>\n" }]
        }], propDecorators: { pageNumber: [{
                type: Input
            }], pageSize: [{
                type: Input
            }], collectionSize: [{
                type: Input
            }], previousButtonText: [{
                type: Input
            }], nextButtonText: [{
                type: Input
            }], pageNumberChange: [{
                type: Output
            }] } });
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoicGFnaW5hdGlvbi5jb21wb25lbnQuanMiLCJzb3VyY2VSb290IjoiIiwic291cmNlcyI6WyIuLi8uLi8uLi8uLi8uLi9wcm9qZWN0cy91cC9jb21wb25lbnRzL3BhZ2luYXRpb24vcGFnaW5hdGlvbi5jb21wb25lbnQudHMiLCIuLi8uLi8uLi8uLi8uLi9wcm9qZWN0cy91cC9jb21wb25lbnRzL3BhZ2luYXRpb24vcGFnaW5hdGlvbi5jb21wb25lbnQuaHRtbCJdLCJuYW1lcyI6W10sIm1hcHBpbmdzIjoiQUFBQSxPQUFPLEVBQUUsU0FBUyxFQUFFLFlBQVksRUFBRSxLQUFLLEVBQXFCLE1BQU0sRUFBRSxNQUFNLGVBQWUsQ0FBQzs7Ozs7QUFNMUYsTUFBTSxPQUFPLG1CQUFtQjtJQUpoQztRQUtXLGVBQVUsR0FBRyxDQUFDLENBQUM7UUFDZixhQUFRLEdBQUcsRUFBRSxDQUFDO1FBQ2QsbUJBQWMsR0FBRyxDQUFDLENBQUM7UUFDbkIsdUJBQWtCLEdBQUcsTUFBTSxDQUFDO1FBQzVCLG1CQUFjLEdBQUcsTUFBTSxDQUFDO1FBRXZCLHFCQUFnQixHQUF5QixJQUFJLFlBQVksRUFBVSxDQUFDO1FBRTlFLFVBQUssR0FBYSxFQUFFLENBQUM7UUFDckIsbUJBQWMsR0FBYSxFQUFFLENBQUM7UUFDOUIsd0JBQW1CLEdBQWEsRUFBRSxDQUFDO1FBQ25DLHVCQUFrQixHQUFhLEVBQUUsQ0FBQztRQUNsQyxlQUFVLEdBQUcsQ0FBQyxDQUFDO1FBQ2Ysc0JBQWlCLEdBQUcsQ0FBQyxDQUFDO1FBQ3RCLHVCQUFrQixHQUFHLENBQUMsQ0FBQztRQUN2QixzQkFBaUIsR0FBRyxDQUFDLENBQUM7S0FrRXZCO0lBaEVDLElBQUksa0JBQWtCO1FBQ3BCLE9BQU8sSUFBSSxDQUFDLGNBQWMsSUFBSSxJQUFJLENBQUMsUUFBUSxDQUFDO0lBQzlDLENBQUM7SUFFRCxRQUFRO1FBQ04sSUFBSSxDQUFDLFVBQVUsQ0FBQyxJQUFJLENBQUMsVUFBVSxDQUFDLENBQUM7SUFDbkMsQ0FBQztJ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QUksQ0FBQyxVQUFVLEVBQUUsRUFBRSxDQUFDLENBQUMsRUFBRSxLQUFLLEVBQUUsRUFBRSxDQUFDLEtBQUssR0FBRyxDQUFDLENBQUMsQ0FBQztJQUNoRixDQUFDOztnSEFqRlUsbUJBQW1CO29HQUFuQixtQkFBbUIsdVNDTmhDLDIyRUFpREE7MkZEM0NhLG1CQUFtQjtrQkFKL0IsU0FBUzsrQkFDRSxlQUFlOzhCQUloQixVQUFVO3NCQUFsQixLQUFLO2dCQUNHLFFBQVE7c0JBQWhCLEtBQUs7Z0JBQ0csY0FBYztzQkFBdEIsS0FBSztnQkFDRyxrQkFBa0I7c0JBQTFCLEtBQUs7Z0JBQ0csY0FBYztzQkFBdEIsS0FBSztnQkFFSSxnQkFBZ0I7c0JBQXpCLE1BQU0iLCJzb3VyY2VzQ29udGVudCI6WyJpbXBvcnQgeyBDb21wb25lbnQsIEV2ZW50RW1pdHRlciwgSW5wdXQsIE9uQ2hhbmdlcywgT25Jbml0LCBPdXRwdXQgfSBmcm9tICdAYW5ndWxhci9jb3JlJztcblxuQENvbXBvbmVudCh7XG4gIHNlbGVjdG9yOiAndXAtcGFnaW5hdGlvbicsXG4gIHRlbXBsYXRlVXJsOiAnLi9wYWdpbmF0aW9uLmNvbXBvbmVudC5odG1sJ1xufSlcbmV4cG9ydCBjbGFzcyBQYWdpbmF0aW9uQ29tcG9uZW50IGltcGxlbWVudHMgT25Jbml0LCBPbkNoYW5nZXMge1xuICBASW5wdXQoKSBwYWdlTnVtYmVyID0gMTtcbiAgQElucHV0KCkgcGFnZVNpemUgPSAxMDtcbiAgQElucHV0KCkgY29sbGVjdGlvblNpemUgPSAwO1xuICBASW5wdXQoKSBwcmV2aW91c0J1dHRvblRleHQgPSAnUHJldic7XG4gIEBJbnB1dCgpIG5leHRCdXR0b25UZXh0ID0gJ05leHQnO1xuXG4gIEBPdXRwdXQoKSBwYWdlTnVtYmVyQ2hhbmdlOiBFdmVudEVtaXR0ZXI8bnVtYmVyPiA9IG5ldyBFdmVudEVtaXR0ZXI8bnVtYmVyPigpO1xuXG4gIHBhZ2VzOiBudW1iZXJbXSA9IFtdO1xuICBnZW5lcmF0ZWRQYWdlczogbnVtYmVyW10gPSBbXTtcbiAgZmlyc3RHZW5lcmF0ZWRQYWdlczogbnVtYmVyW10gPSBbXTtcbiAgbGFzdEdlbmVyYXRlZFBhZ2VzOiBudW1iZXJbXSA9IFtdO1xuICB0b3RhbFBhZ2VzID0gMDtcbiAgdG90YWxWaXNpYmxlUGFnZXMgPSA5O1xuICBmaXJzdEdlbmVyYXRlZFBhZ2UgPSAwO1xuICBsYXN0R2VuZXJhdGVkUGFnZSA9IDA7XG5cbiAgZ2V0IGlzUGFnaW5hdGlvbkhpZGRlbigpOiBib29sZWFuIHtcbiAgICByZXR1cm4gdGhpcy5jb2xsZWN0aW9uU2l6ZSA8PSB0aGlzLnBhZ2VTaXplO1xuICB9XG5cbiAgbmdPbkluaXQoKTogdm9pZCB7XG4gICAgdGhpcy5zZWxlY3RQYWdlKHRoaXMucGFnZU51bWJlcik7XG4gIH1cblxuICBuZ09uQ2hhbmdlcygpOiB2b2lkIHtcbiAgICB0aGlzLmJ1aWxkUGFnZXMoKTtcbiAgfVxuXG4gIHNlbGVjdFBhZ2UobmV3UGFnZU51bWJlcjogbnVtYmVyKTogdm9pZCB7XG4gICAgY29uc3QgaXNJblRoZUFsbG93ZWRQYWdlc0ludGVydmFsID0gbmV3UGFnZU51bWJlciA+PSAxICYmIG5ld1BhZ2VOdW1iZXIgPD0gdGhpcy50b3RhbFBhZ2VzO1xuICAgIGlmIChpc0luVGhlQWxsb3dlZFBhZ2VzSW50ZXJ2YWwgJiYgbmV3UGFnZU51bWJlciAhPT0gdGhpcy5wYWdlTnVtYmVyKSB7XG4gICAgICB0aGlzLnBhZ2VOdW1iZXJDaGFuZ2UuZW1pdChuZXdQYWdlTnVtYmVyKTtcbiAgICB9XG5cbiAgICB0aGlzLmdlbmVyYXRlZFBhZ2VzID0gW107XG4gICAgdGhpcy5maXJzdEdlbmVyYXRlZFBhZ2VzID0gW107XG4gICAgdGhpcy5sYXN0R2VuZXJhdGVkUGFnZXMgPSBbXTtcbiAgICB0aGlzLmZpcnN0R2VuZXJhdGVkUGFnZSA9IG5ld1BhZ2VOdW1iZXIgLSAyO1xuICAgIHRoaXMubGFzdEdlbmVyYXRlZFBhZ2UgPSBuZXdQYWdlTnVtYmVyICsgMjtcblxuICAgIGlmICh0aGlzLnRvdGFsUGFnZXMgPj0gdGhpcy50b3RhbFZpc2libGVQYWdlcykge1xuICAgICAgaWYgKG5ld1BhZ2VOdW1iZXIgPT09IDEpIHtcbiAgICAgICAgdGhpcy5sYXN0R2VuZXJhdGVkUGFnZSArPSAyO1xuICAgICAgfSBlbHNlIGlmIChuZXdQYWdlTnVtYmVyID09PSAyKSB7XG4gICAgICAgIHRoaXMubGFzdEdlbmVyYXRlZFBhZ2UgKz0gMTtcbiAgICAgIH1cbiAgICAgIGlmIChuZXdQYWdlTnVtYmVyID09PSB0aGlzLnRvdGFsUGFnZXMpIHtcbiAgICAgICAgdGhpcy5maXJzdEdlbmVyYXRlZFBhZ2UgLT0gMjtcbiAgICAgIH0gZWxzZSBpZiAobmV3UGFnZU51bWJlciA9PT0gdGhpcy50b3RhbFBhZ2VzIC0gMSkge1xuICAgICAgICB0aGlzLmZpcnN0R2VuZXJhdGVkUGFnZSAtPSAxO1xuICAgICAgfVxuXG4gICAgICBmb3IgKGxldCBwYWdlID0gdGhpcy5maXJzdEdlbmVyYXRlZFBhZ2U7IHBhZ2UgPD0gdGhpcy5sYXN0R2VuZXJhdGVkUGFnZTsgcGFnZSsrKSB7XG4gICAgICAgIGlmIChwYWdlID09PSAwKSB7XG4gICAgICAgICAgcGFnZSArPSAxO1xuICAgICAgICB9XG4gICAgICAgIGlmIChwYWdlID4gdGhpcy50b3RhbFBhZ2VzKSB7XG4gICAgICAgICAgY29udGludWU7XG4gICAgICAgIH1cbiAgICAgICAgdGhpcy5nZW5lcmF0ZWRQYWdlcy5wdXNoKHBhZ2UpO1xuICAgICAgfVxuXG4gICAgICBpZiAobmV3UGFnZU51bWJlciA8PSA0IHx8IG5ld1BhZ2VOdW1iZXIgPj0gdGhpcy50b3RhbFBhZ2VzIC0gMykge1xuICAgICAgICBmb3IgKGxldCBwYWdlID0gMTsgcGFnZSA8PSA0OyBwYWdlKyspIHtcbiAgICAgICAgICB0aGlzLmZpcnN0R2VuZXJhdGVkUGFnZXMucHVzaChwYWdlKTtcbiAgICAgICAgfVxuICAgICAgICBmb3IgKGxldCBwYWdlID0gdGhpcy50b3RhbFBhZ2VzIC0gMzsgcGFnZSA8PSB0aGlzLnRvdGFsUGFnZXM7IHBhZ2UrKykge1xuICAgICAgICAgIHRoaXMubGFzdEdlbmVyYXRlZFBhZ2VzLnB1c2gocGFnZSk7XG4gICAgICAgIH1cbiAgICAgIH0gZWxzZSB7XG4gICAgICAgIHRoaXMuZmlyc3RHZW5lcmF0ZWRQYWdlcy5wdXNoKDEpO1xuICAgICAgICB0aGlzLmxhc3RHZW5lcmF0ZWRQYWdlcy5wdXNoKHRoaXMudG90YWxQYWdlcyk7XG4gICAgICB9XG4gICAgfVxuICB9XG5cbiAgYnVpbGRQYWdlcygpOiB2b2lkIHtcbiAgICB0aGlzLnRvdGFsUGFnZXMgPSBNYXRoLmNlaWwodGhpcy5jb2xsZWN0aW9uU2l6ZSAvIHRoaXMucGFnZVNpemUpO1xuICAgIHRoaXMucGFnZXMgPSBBcnJheS5mcm9tKHsgbGVuZ3RoOiB0aGlzLnRvdGFsUGFnZXMgfSwgKF8sIGluZGV4KSA9PiBpbmRleCArIDEpO1xuICB9XG59XG4iLCI8dWwgY2xhc3M9XCJ1cC1wYWdpbmF0aW9uXCIgW2NsYXNzLmhpZGRlbl09XCJpc1BhZ2luYXRpb25IaWRkZW5cIj5cbiAgPGxpIGNsYXNzPVwidXAtcGFnaW5hdGlvbi1uYXZpZ2F0aW9uLWNvbnRhaW5lciB1cC1wYWdpbmF0aW9uLXByZXZpb3VzLXBhZ2VcIj5cbiAgICA8bmctY29udGFpbmVyICpuZ0lmPVwicGFnZU51bWJlciA+IDFcIj5cbiAgICAgIDxkaXYgY2xhc3M9XCJ1cC1wYWdpbmF0aW9uLW5hdmlnYXRpb24taWNvbiBjdXJzb3ItZ3JhYlwiIChjbGljayk9XCJzZWxlY3RQYWdlKDEpXCI+XG4gICAgICAgIDxpIHVwSWNvbj1cImZpcnN0X3BhZ2Vfc21hbGxcIiB3aWR0aD1cIjhweFwiIGhlaWdodD1cIjhweFwiPjwvaT5cbiAgICAgIDwvZGl2PlxuICAgICAgPHNwYW4gY2xhc3M9XCJ1cC1wYWdpbmF0aW9uLW5hdmlnYXRpb25cIiB1cE1hcmdpbkxlZnQ9XCIxXCIgKGNsaWNrKT1cInNlbGVjdFBhZ2UocGFnZU51bWJlciAtIDEpXCI+e3twcmV2aW91c0J1dHRvblRleHR9fTwvc3Bhbj5cbiAgICA8L25nLWNvbnRhaW5lcj5cbiAgPC9saT5cbiAgPG5nLWNvbnRhaW5lciAqbmdJZj1cInRvdGFsUGFnZXMgPD0gdG90YWxWaXNpYmxlUGFnZXMgZWxzZSBzaG93RWxsaXBzaXNcIj5cbiAgICA8bGkgKm5nRm9yPVwibGV0IHBhZ2Ugb2YgcGFnZXNcIiBbY2xhc3MuYWN0aXZlXT1cInBhZ2VOdW1iZXIgPT09IHBhZ2VcIlxuICAgICAgICBjbGFzcz1cInVwLXBhZ2luYXRpb24taXRlbSB1cC1wYWdpbmF0aW9uLW51bWJlclwiPlxuICAgICAgPGEgKGNsaWNrKT1cInNlbGVjdFBhZ2UocGFnZSlcIj57e3BhZ2V9fTwvYT5cbiAgICA8L2xpPlxuICA8L25nLWNvbnRhaW5lcj5cbiAgPG5nLXRlbXBsYXRlICNzaG93RWxsaXBzaXM+XG4gICAgPGxpICpuZ0Zvcj1cImxldCBwYWdlIG9mIGZpcnN0R2VuZXJhdGVkUGFnZXNcIiBjbGFzcz1cInVwLXBhZ2luYXRpb24taXRlbSB1cC1wYWdpbmF0aW9uLW51bWJlclwiIFtjbGFzcy5hY3RpdmVdPVwicGFnZU51bWJlciA9PT0gcGFnZVwiPlxuICAgICAgPGEgKGNsaWNrKT1cInNlbGVjdFBhZ2UocGFnZSlcIj57e3BhZ2V9fTwvYT5cbiAgICA8L2xpPlxuICAgIDxuZy1jb250YWluZXIgKm5nSWY9XCJwYWdlTnVtYmVyID49IDVcIj5cbiAgICAgIDxsaSBjbGFzcz1cInVwLXBhZ2luYXRpb24taXRlbVwiPlxuICAgICAgICA8YSBjbGFzcz1cImRvdHNcIj4uLi48L2E+XG4gICAgICA8L2xpPlxuICAgIDwvbmctY29udGFpbmVyPlxuXG4gICAgPG5nLWNvbnRhaW5lciAqbmdJZj1cInBhZ2VOdW1iZXIgPj0gNSAmJiBwYWdlTnVtYmVyIDw9IHRvdGFsUGFnZXMtNFwiPlxuICAgICAgPGxpICpuZ0Zvcj1cImxldCBwYWdlIG9mIGdlbmVyYXRlZFBhZ2VzXCIgY2xhc3M9XCJ1cC1wYWdpbmF0aW9uLWl0ZW0gdXAtcGFnaW5hdGlvbi1udW1iZXJcIiBbY2xhc3MuYWN0aXZlXT1cInBhZ2VOdW1iZXIgPT09IHBhZ2VcIj5cbiAgICAgICAgPGEgKGNsaWNrKT1cInNlbGVjdFBhZ2UocGFnZSlcIj57e3BhZ2V9fTwvYT48L2xpPlxuICAgIDwvbmctY29udGFpbmVyPlxuXG4gICAgPG5nLWNvbnRhaW5lciAqbmdJZj1cInBhZ2VOdW1iZXIgPCB0b3RhbFBhZ2VzIC0gM1wiPlxuICAgICAgPGxpIGNsYXNzPVwidXAtcGFnaW5hdGlvbi1pdGVtXCI+XG4gICAgICAgIDxhIGNsYXNzPVwiZG90c1wiPi4uLjwvYT5cbiAgICAgIDwvbGk+XG4gICAgPC9uZy1jb250YWluZXI+XG4gICAgPGxpICpuZ0Zvcj1cImxldCBwYWdlIG9mIGxhc3RHZW5lcmF0ZWRQYWdlc1wiIGNsYXNzPVwidXAtcGFnaW5hdGlvbi1pdGVtIHVwLXBhZ2luYXRpb24tbnVtYmVyXCIgW2NsYXNzLmFjdGl2ZV09XCJwYWdlTnVtYmVyID09PSBwYWdlXCI+XG4gICAgICA8YSAoY2xpY2spPVwic2VsZWN0UGFnZShwYWdlKVwiPnt7cGFnZX19PC9hPlxuICAgIDwvbGk+XG4gIDwvbmctdGVtcGxhdGU+XG5cbiAgPGxpIGNsYXNzPVwidXAtcGFnaW5hdGlvbi1uYXZpZ2F0aW9uLWNvbnRhaW5lciB1cC1wYWdpbmF0aW9uLW5leHQtcGFnZVwiPlxuICAgIDxuZy1jb250YWluZXIgKm5nSWY9XCJwYWdlTnVtYmVyICE9PSB0b3RhbFBhZ2VzXCI+XG4gICAgICA8c3BhbiBjbGFzcz1cInVwLXBhZ2luYXRpb24tbmF2aWdhdGlvblwiIHVwTWFyZ2luUmlnaHQ9XCIxXCIgKGNsaWNrKT1cInNlbGVjdFBhZ2UocGFnZU51bWJlciArIDEpXCI+e3tuZXh0QnV0dG9uVGV4dH19PC9zcGFuPlxuICAgICAgPGRpdiBjbGFzcz1cInVwLXBhZ2luYXRpb24tbmF2aWdhdGlvbi1pY29uIGN1cnNvci1ncmFiXCIgKGNsaWNrKT1cInNlbGVjdFBhZ2UodG90YWxQYWdlcylcIj5cbiAgICAgICAgPGkgdXBJY29uPVwibGFzdF9wYWdlX3NtYWxsXCIgd2lkdGg9XCI4cHhcIiBoZWlnaHQ9XCI4cHhcIj48L2k+XG4gICAgICA8L2Rpdj5cbiAgICA8L25nLWNvbnRhaW5lcj5cbiAgPC9saT5cbjwvdWw+XG4iXX0=
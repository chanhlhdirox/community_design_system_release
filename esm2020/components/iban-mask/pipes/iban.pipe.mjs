import { Pipe } from '@angular/core';
import * as IBAN from 'iban';
import * as i0 from "@angular/core";
export var COUNTRY_CODE_CHECKSUM_SUFFIX;
(function (COUNTRY_CODE_CHECKSUM_SUFFIX) {
    COUNTRY_CODE_CHECKSUM_SUFFIX["RS"] = "RS35";
})(COUNTRY_CODE_CHECKSUM_SUFFIX || (COUNTRY_CODE_CHECKSUM_SUFFIX = {}));
export class IbanPipe {
    transform(value, autocompleteCountryCodeAndChecksum = false, countryCode = '') {
        if (!value) {
            return '';
        }
        return IBAN.printFormat(this.cleanIban(value, autocompleteCountryCodeAndChecksum, countryCode));
    }
    parse(value, autocompleteCountryCodeAndChecksum = false, countryCode = '') {
        if (!value) {
            return '';
        }
        const iban = this.cleanIban(value, autocompleteCountryCodeAndChecksum, countryCode);
        return iban;
    }
    cleanIban(value, autocompleteCountryCodeAndChecksum = false, countryCode = '') {
        let iban;
        if (autocompleteCountryCodeAndChecksum &&
            countryCode &&
            COUNTRY_CODE_CHECKSUM_SUFFIX[countryCode] &&
            ((value.length === 1 && !this.onlyLetters(value)) || IBAN.isValidBBAN(countryCode, value))) {
            iban = IBAN.electronicFormat(`${COUNTRY_CODE_CHECKSUM_SUFFIX[countryCode]}${value}`);
        }
        else {
            iban = IBAN.electronicFormat(value);
        }
        if (iban.length < 3 && !this.onlyLetters(iban[iban?.length - 1])) {
            return this.removeLast(iban);
        }
        if (iban.length < 3) {
            return value;
        }
        const country = iban.substr(0, 2);
        if (!IBAN.countries.hasOwnProperty(country)) {
            return country;
        }
        const countrySpecification = IBAN.countries[country];
        if (iban.length > countrySpecification.length) {
            return iban.substr(0, countrySpecification.length);
        }
        return iban;
    }
    onlyLetters(value) {
        if (!value) {
            return true;
        }
        return value.toLowerCase() !== value.toUpperCase();
    }
    removeLast(value) {
        if (!value) {
            return '';
        }
        return value.substr(0, value.length - 1);
    }
}
IbanPipe.ɵfac = i0.ɵɵngDeclareFactory({ minVersion: "12.0.0", version: "14.3.0", ngImport: i0, type: IbanPipe, deps: [], target: i0.ɵɵFactoryTarget.Pipe });
IbanPipe.ɵpipe = i0.ɵɵngDeclarePipe({ minVersion: "14.0.0", version: "14.3.0", ngImport: i0, type: IbanPipe, name: "IBAN" });
i0.ɵɵngDeclareClassMetadata({ minVersion: "12.0.0", version: "14.3.0", ngImport: i0, type: IbanPipe, decorators: [{
            type: Pipe,
            args: [{
                    name: 'IBAN'
                }]
        }] });
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiaWJhbi5waXBlLmpzIiwic291cmNlUm9vdCI6IiIsInNvdXJjZXMiOlsiLi4vLi4vLi4vLi4vLi4vLi4vcHJvamVjdHMvdXAvY29tcG9uZW50cy9pYmFuLW1hc2svcGlwZXMvaWJhbi5waXBlLnRzIl0sIm5hbWVzIjpbXSwibWFwcGluZ3MiOiJBQUFBLE9BQU8sRUFBRSxJQUFJLEVBQWlCLE1BQU0sZUFBZSxDQUFDO0FBQ3BELE9BQU8sS0FBSyxJQUFJLE1BQU0sTUFBTSxDQUFDOztBQUU3QixNQUFNLENBQU4sSUFBWSw0QkFFWDtBQUZELFdBQVksNEJBQTRCO0lBQ3RDLDJDQUFXLENBQUE7QUFDYixDQUFDLEVBRlcsNEJBQTRCLEtBQTVCLDRCQUE0QixRQUV2QztBQUtELE1BQU0sT0FBTyxRQUFRO0lBQ25CLFNBQVMsQ0FBQyxLQUFVLEVBQUUsa0NBQWtDLEdBQUcsS0FBSyxFQUFFLFdBQVcsR0FBRyxFQUFFO1FBQ2hGLElBQUksQ0FBQyxLQUFLLEVBQUU7WUFDVixPQUFPLEVBQUUsQ0FBQztTQUNYO1FBRUQsT0FBTyxJQUFJLENBQUMsV0FBVyxDQUFDLElBQUksQ0FBQyxTQUFTLENBQUMsS0FBSyxFQUFFLGtDQUFrQyxFQUFFLFdBQVcsQ0FBQyxDQUFDLENBQUM7SUFDbEcsQ0FBQztJQUVELEtBQUssQ0FBQyxLQUFVLEVBQUUsa0NBQWtDLEdBQUcsS0FBSyxFQUFFLFdBQVcsR0FBRyxFQUFFO1FBQzVFLElBQUksQ0FBQyxLQUFLLEVBQUU7WUFDVixPQUFPLEVBQUUsQ0FBQztTQUNYO1FBQ0QsTUFBTSxJQUFJLEdBQVcsSUFBSSxDQUFDLFNBQVMsQ0FBQyxLQUFLLEVBQUUsa0NBQWtDLEVBQUUsV0FBVyxDQUFDLENBQUM7UUFFNUYsT0FBTyxJQUFJLENBQUM7SUFDZCxDQUFDO0lBRU8sU0FBUyxDQUNmLEtBQWEsRUFDYixrQ0FBa0MsR0FBRyxLQUFLLEVBQzFDLFdBQVcsR0FBRyxFQUFFO1FBRWhCLElBQUksSUFBWSxDQUFDO1FBRWpCLElBQ0Usa0NBQWtDO1lBQ2xDLFdBQVc7WUFDWCw0QkFBNEIsQ0FBQyxXQUFXLENBQUM7WUFDekMsQ0FBQyxDQUFDLEtBQUssQ0FBQyxNQUFNLEtBQUssQ0FBQyxJQUFJLENBQUMsSUFBSSxDQUFDLFdBQVcsQ0FBQyxLQUFLLENBQUMsQ0FBQyxJQUFJLElBQUksQ0FBQyxXQUFXLENBQUMsV0FBVyxFQUFFLEtBQUssQ0FBQyxDQUFDLEVBQzFGO1lBQ0EsSUFBSSxHQUFHLElBQUksQ0FBQyxnQkFBZ0IsQ0FBQyxHQUFHLDRCQUE0QixDQUFDLFdBQVcsQ0FBQyxHQUFHLEtBQUssRUFBRSxDQUFDLENBQUM7U0FDdEY7YUFBTTtZQUNMLElBQUksR0FBRyxJQUFJLENBQUMsZ0JBQWdCLENBQUMsS0FBSyxDQUFDLENBQUM7U0FDckM7UUFFRCxJQUFJLElBQUksQ0FBQyxNQUFNLEdBQUcsQ0FBQyxJQUFJLENBQUMsSUFBSSxDQUFDLFdBQVcsQ0FBQyxJQUFJLENBQUMsSUFBSSxFQUFFLE1BQU0sR0FBRyxDQUFDLENBQUMsQ0FBQyxFQUFFO1lBQ2hFLE9BQU8sSUFBSSxDQUFDLFVBQVUsQ0FBQyxJQUFJLENBQUMsQ0FBQztTQUM5QjtRQUVELElBQUksSUFBSSxDQUFDLE1BQU0sR0FBRyxDQUFDLEVBQUU7WUFDbkIsT0FBTyxLQUFLLENBQUM7U0FDZDtRQUVELE1BQU0sT0FBTyxHQUFHLElBQUksQ0FBQyxNQUFNLENBQUMsQ0FBQyxFQUFFLENBQUMsQ0FBQyxDQUFDO1FBQ2xDLElBQUksQ0FBQyxJQUFJLENBQUMsU0FBUyxDQUFDLGNBQWMsQ0FBQyxPQUFPLENBQUMsRUFBRTtZQUMzQyxPQUFPLE9BQU8sQ0FBQztTQUNoQjtRQUVELE1BQU0sb0JBQW9CLEdBQUcsSUFBSSxDQUFDLFNBQVMsQ0FBQyxPQUFPLENBQUMsQ0FBQztRQUNyRCxJQUFJLElBQUksQ0FBQyxNQUFNLEdBQUcsb0JBQW9CLENBQUMsTUFBTSxFQUFFO1lBQzdDLE9BQU8sSUFBSSxDQUFDLE1BQU0sQ0FBQyxDQUFDLEVBQUUsb0JBQW9CLENBQUMsTUFBTSxDQUFDLENBQUM7U0FDcEQ7UUFFRCxPQUFPLElBQUksQ0FBQztJQUNkLENBQUM7SUFFTyxXQUFXLENBQUMsS0FBYTtRQUMvQixJQUFJLENBQUMsS0FBSyxFQUFFO1lBQ1YsT0FBTyxJQUFJLENBQUM7U0FDYjtRQUNELE9BQU8sS0FBSyxDQUFDLFdBQVcsRUFBRSxLQUFLLEtBQUssQ0FBQyxXQUFXLEVBQUUsQ0FBQztJQUNyRCxDQUFDO0lBRU8sVUFBVSxDQUFDLEtBQWE7UUFDOUIsSUFBSSxDQUFDLEtBQUssRUFBRTtZQUNWLE9BQU8sRUFBRSxDQUFDO1NBQ1g7UUFFRCxPQUFPLEtBQUssQ0FBQyxNQUFNLENBQUMsQ0FBQyxFQUFFLEtBQUssQ0FBQyxNQUFNLEdBQUcsQ0FBQyxDQUFDLENBQUM7SUFDM0MsQ0FBQzs7cUdBdEVVLFFBQVE7bUdBQVIsUUFBUTsyRkFBUixRQUFRO2tCQUhwQixJQUFJO21CQUFDO29CQUNKLElBQUksRUFBRSxNQUFNO2lCQUNiIiwic291cmNlc0NvbnRlbnQiOlsiaW1wb3J0IHsgUGlwZSwgUGlwZVRyYW5zZm9ybSB9IGZyb20gJ0Bhbmd1bGFyL2NvcmUnO1xuaW1wb3J0ICogYXMgSUJBTiBmcm9tICdpYmFuJztcblxuZXhwb3J0IGVudW0gQ09VTlRSWV9DT0RFX0NIRUNLU1VNX1NVRkZJWCB7XG4gIFJTID0gJ1JTMzUnXG59XG5cbkBQaXBlKHtcbiAgbmFtZTogJ0lCQU4nXG59KVxuZXhwb3J0IGNsYXNzIEliYW5QaXBlIGltcGxlbWVudHMgUGlwZVRyYW5zZm9ybSB7XG4gIHRyYW5zZm9ybSh2YWx1ZTogYW55LCBhdXRvY29tcGxldGVDb3VudHJ5Q29kZUFuZENoZWNrc3VtID0gZmFsc2UsIGNvdW50cnlDb2RlID0gJycpOiBzdHJpbmcge1xuICAgIGlmICghdmFsdWUpIHtcbiAgICAgIHJldHVybiAnJztcbiAgICB9XG5cbiAgICByZXR1cm4gSUJBTi5wcmludEZvcm1hdCh0aGlzLmNsZWFuSWJhbih2YWx1ZSwgYXV0b2NvbXBsZXRlQ291bnRyeUNvZGVBbmRDaGVja3N1bSwgY291bnRyeUNvZGUpKTtcbiAgfVxuXG4gIHBhcnNlKHZhbHVlOiBhbnksIGF1dG9jb21wbGV0ZUNvdW50cnlDb2RlQW5kQ2hlY2tzdW0gPSBmYWxzZSwgY291bnRyeUNvZGUgPSAnJyk6IHN0cmluZyB7XG4gICAgaWYgKCF2YWx1ZSkge1xuICAgICAgcmV0dXJuICcnO1xuICAgIH1cbiAgICBjb25zdCBpYmFuOiBzdHJpbmcgPSB0aGlzLmNsZWFuSWJhbih2YWx1ZSwgYXV0b2NvbXBsZXRlQ291bnRyeUNvZGVBbmRDaGVja3N1bSwgY291bnRyeUNvZGUpO1xuXG4gICAgcmV0dXJuIGliYW47XG4gIH1cblxuICBwcml2YXRlIGNsZWFuSWJhbihcbiAgICB2YWx1ZTogc3RyaW5nLFxuICAgIGF1dG9jb21wbGV0ZUNvdW50cnlDb2RlQW5kQ2hlY2tzdW0gPSBmYWxzZSxcbiAgICBjb3VudHJ5Q29kZSA9ICcnXG4gICk6IHN0cmluZyB7XG4gICAgbGV0IGliYW46IHN0cmluZztcblxuICAgIGlmIChcbiAgICAgIGF1dG9jb21wbGV0ZUNvdW50cnlDb2RlQW5kQ2hlY2tzdW0gJiZcbiAgICAgIGNvdW50cnlDb2RlICYmXG4gICAgICBDT1VOVFJZX0NPREVfQ0hFQ0tTVU1fU1VGRklYW2NvdW50cnlDb2RlXSAmJlxuICAgICAgKCh2YWx1ZS5sZW5ndGggPT09IDEgJiYgIXRoaXMub25seUxldHRlcnModmFsdWUpKSB8fCBJQkFOLmlzVmFsaWRCQkFOKGNvdW50cnlDb2RlLCB2YWx1ZSkpXG4gICAgKSB7XG4gICAgICBpYmFuID0gSUJBTi5lbGVjdHJvbmljRm9ybWF0KGAke0NPVU5UUllfQ09ERV9DSEVDS1NVTV9TVUZGSVhbY291bnRyeUNvZGVdfSR7dmFsdWV9YCk7XG4gICAgfSBlbHNlIHtcbiAgICAgIGliYW4gPSBJQkFOLmVsZWN0cm9uaWNGb3JtYXQodmFsdWUpO1xuICAgIH1cblxuICAgIGlmIChpYmFuLmxlbmd0aCA8IDMgJiYgIXRoaXMub25seUxldHRlcnMoaWJhbltpYmFuPy5sZW5ndGggLSAxXSkpIHtcbiAgICAgIHJldHVybiB0aGlzLnJlbW92ZUxhc3QoaWJhbik7XG4gICAgfVxuXG4gICAgaWYgKGliYW4ubGVuZ3RoIDwgMykge1xuICAgICAgcmV0dXJuIHZhbHVlO1xuICAgIH1cblxuICAgIGNvbnN0IGNvdW50cnkgPSBpYmFuLnN1YnN0cigwLCAyKTtcbiAgICBpZiAoIUlCQU4uY291bnRyaWVzLmhhc093blByb3BlcnR5KGNvdW50cnkpKSB7XG4gICAgICByZXR1cm4gY291bnRyeTtcbiAgICB9XG5cbiAgICBjb25zdCBjb3VudHJ5U3BlY2lmaWNhdGlvbiA9IElCQU4uY291bnRyaWVzW2NvdW50cnldO1xuICAgIGlmIChpYmFuLmxlbmd0aCA+IGNvdW50cnlTcGVjaWZpY2F0aW9uLmxlbmd0aCkge1xuICAgICAgcmV0dXJuIGliYW4uc3Vic3RyKDAsIGNvdW50cnlTcGVjaWZpY2F0aW9uLmxlbmd0aCk7XG4gICAgfVxuXG4gICAgcmV0dXJuIGliYW47XG4gIH1cblxuICBwcml2YXRlIG9ubHlMZXR0ZXJzKHZhbHVlOiBzdHJpbmcpOiBib29sZWFuIHtcbiAgICBpZiAoIXZhbHVlKSB7XG4gICAgICByZXR1cm4gdHJ1ZTtcbiAgICB9XG4gICAgcmV0dXJuIHZhbHVlLnRvTG93ZXJDYXNlKCkgIT09IHZhbHVlLnRvVXBwZXJDYXNlKCk7XG4gIH1cblxuICBwcml2YXRlIHJlbW92ZUxhc3QodmFsdWU6IHN0cmluZyk6IHN0cmluZyB7XG4gICAgaWYgKCF2YWx1ZSkge1xuICAgICAgcmV0dXJuICcnO1xuICAgIH1cblxuICAgIHJldHVybiB2YWx1ZS5zdWJzdHIoMCwgdmFsdWUubGVuZ3RoIC0gMSk7XG4gIH1cbn1cbiJdfQ==